<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respiratory Support - BreatheAI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='assets/favicon.jpg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=7">

</head>
<body>
    <div class="container">
        <a href="#" onclick="history.back(); return false;" class="back-button">â† Back</a>
        
        <header class="emergency-header">
            <h1 class="emergency-title">Respiratory Support</h1>
            <p class="emergency-subtitle">Emergency resources & immediate help</p>
        </header>

        <div class="support-grid">
            <!-- 1. Immediate Help (Maps) -->
            <div class="support-card" style="border-color: rgba(239, 68, 68, 0.5);">
                <h2 style="color: #fca5a5;">ğŸš‘ Find Help Now</h2>
                <p style="color: #94a3b8; margin-bottom: 1.5rem; font-size: 0.9rem;">Locate nearest medical facilities using live maps.</p>
                
                <a href="https://www.google.com/maps/search/pharmacy+with+inhalers+near+me" target="_blank" class="action-btn btn-primary">
                    <span>ğŸ’Š Nearest Pharmacies</span>
                </a>
                <a href="https://www.google.com/maps/search/nebulisation+center+near+me" target="_blank" class="action-btn btn-secondary">
                    <span>ğŸ’¨ Nebulisation Centers</span>
                </a>
                <a href="https://www.google.com/maps/search/pulmonologist+near+me" target="_blank" class="action-btn btn-outline">
                    <span>ğŸ‘¨â€âš•ï¸ Find Pulmonologist</span>
                </a>
            </div>

            <!-- 2. Emergency Contacts -->
            <div class="support-card">
                <h2>ğŸ“ Emergency Contacts</h2>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <a href="tel:102" class="action-btn" style="background: #dc2626; color: white; font-size: 1.2rem;">
                        ğŸš‘ Call Ambulance (102)
                    </a>
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 12px;">
                        <strong style="display: block; color: #cbd5e1; margin-bottom: 0.2rem;">National Emergency</strong>
                        <span style="font-size: 1.5rem; font-weight: 700; color: white;">112</span>
                    </div>
                </div>
            </div>

            <!-- 3. Home Oxygen Providers -->
            <div class="support-card">
                <h2>ğŸ« Home Oxygen</h2>
                <p style="color: #94a3b8; margin-bottom: 1rem; font-size: 0.9rem;">Verified providers for emergency oxygen.</p>
                <ul class="tips-list">
                    <li>
                        <strong>Apollo HomeCare</strong><br>
                        <a href="tel:18605001066" style="color: #fff; text-decoration: underline;">1860 500 1066</a>
                    </li>
                    <li>
                        <strong>Portea Medical</strong><br>
                        <a href="tel:18001212323" style="color: #fff; text-decoration: underline;">1800 121 2323</a>
                    </li>
                    <li>
                        <a href="https://www.google.com/maps/search/oxygen+cylinder+supplier+near+me" target="_blank" style="color: #38bdf8; display: block; margin-top: 0.5rem;">ğŸ” Search Local Suppliers â†’</a>
                    </li>
                </ul>
            </div>

            <!-- 4. Emergency Air Cleaning Tips -->
            <div class="support-card" style="grid-column: 1 / -1;">
                <h2>ğŸ’¨ Emergency Air Cleaning Tips</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div>
                        <strong style="color: #38bdf8; font-size: 1.1rem;">Create a "Clean Room"</strong>
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">
                            Choose a room with few windows. Seal gaps with tape/towels. Run an air purifier on high. Stay in this room during peak pollution.
                        </p>
                    </div>
                    <div>
                        <strong style="color: #38bdf8; font-size: 1.1rem;">Steam Inhalation</strong>
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">
                            If you feel congestion, steam inhalation can help clear airways. Add a drop of eucalyptus oil if available.
                        </p>
                    </div>
                    <div>
                        <strong style="color: #38bdf8; font-size: 1.1rem;">Wet Mopping</strong>
                        <p style="color: #cbd5e1; font-size: 0.9rem; margin-top: 0.5rem; line-height: 1.5;">
                            Wet mop floors twice daily to trap settled dust. Do not sweep with a broom as it re-suspends particles.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Parse city/country from URL
        const urlParams = new URLSearchParams(window.location.search);
        const city = urlParams.get('city');
        const country = urlParams.get('country') || '';

        if (city) {
            // Update Header
            const subtitle = document.querySelector('.emergency-subtitle');
            if (subtitle) {
                subtitle.textContent = `Emergency resources in ${city} & immediate help`;
            }

            // Update Google Maps Links
            const mapLinks = document.querySelectorAll('a[href^="https://www.google.com/maps/search/"]');
            mapLinks.forEach(link => {
                let href = link.getAttribute('href');
                if (href.includes('near+me')) {
                    href = href.replace('near+me', `in+${encodeURIComponent(city)}`);
                } else {
                    href += `+in+${encodeURIComponent(city)}`;
                }
                link.setAttribute('href', href);
            });
            
            // Fetch Emergency Numbers
            fetch(`/api/support?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}`)
                .then(res => res.json())
                .then(data => {
                    if (data.ambulance) {
                        // Update Ambulance
                        const ambulanceBtn = document.querySelector('a[href^="tel:"]');
                        if (ambulanceBtn) {
                            ambulanceBtn.href = `tel:${data.ambulance}`;
                            ambulanceBtn.innerHTML = `ğŸš‘ Call Ambulance (${data.ambulance})`;
                        }
                        
                        // Update General/National
                        const nationalNum = document.querySelector('.support-card span[style*="font-size: 1.5rem"]');
                        if (nationalNum) {
                            nationalNum.textContent = data.general || data.police;
                        }
                        
                        // Add Notes if available
                        if (data.notes) {
                            const notesDiv = document.createElement('div');
                            notesDiv.style.marginTop = '1rem';
                            notesDiv.style.color = '#94a3b8';
                            notesDiv.style.fontSize = '0.9rem';
                            notesDiv.innerHTML = `â„¹ï¸ ${data.notes}`;
                            document.querySelector('.support-card:nth-child(2)').appendChild(notesDiv);
                        }
                    }
                })
                .catch(err => console.error("Failed to fetch emergency info:", err));
        }
    </script>
</body>
</html>
